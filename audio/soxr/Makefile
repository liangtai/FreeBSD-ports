# $FreeBSD$

PORTNAME=	soxr
PORTVERSION=	0.1.2
DISTVERSIONSUFFIX=	-Source
CATEGORIES=	audio
MASTER_SITES=	SF/${PORTNAME}/

MAINTAINER=	liangtai.s16@gmail.com
COMMENT=	High quality, one-dimensional sample-rate conversion library

LICENSE=	LGPL21

USES=		cmake pathfix pkgconfig tar:xz

PORTDOCS=	NEWS README

OPTIONS_SUB=	yes
OPTIONS_DEFINE=	OPENMP SHLIB SIMD LSRLIKE
OPTIONS_RADIO=	SIMD_DFT
OPTIONS_RADIO_SIMD_DFT=	_NOUSE AVFFT PFFFT
OPTIONS_GROUP=	PRECISION
OPTIONS_GROUP_PRECISION=	PREC_D PREC_S

OPTIONS_DEFAULT=	OPENMP PFFFT PREC_D PREC_S SHLIB SIMD LSRLIKE

LSRLIKE_DESC=	Include a libsamplerate-like interface
LSRLIKE_CMAKE_ON=	-DWITH_LSR_BINDINGS:BOOL=ON
LSRLIKE_CMAKE_OFF=	-DWITH_LSR_BINDINGS:BOOL=OFF

OPENMP_CMAKE_ON=	-DWITH_OPENMP:BOOL=ON
OPENMP_CMAKE_OFF=	-DWITH_OPENMP:BOOL=OFF
OPENMP_USE=	compiler:openmp

SIMD_CMAKE_ON=	-DWITH_SIMD:BOOL=ON
SIMD_CMAKE_OFF=	-DWITH_SIMD:BOOL=OFF

SHLIB_DESC=	Build shared libraries, otherwise static libraries
SHLIB_CMAKE_ON=	-DBUILD_SHARED_LIBS:BOOL=ON
SHLIB_CMAKE_OFF=	-DBUILD_SHARED_LIBS:BOOL=OFF

PREC_D_DESC=	Build with double precision (for up to 32-bit accuracy)
PREC_S_DESC=	Build with single precision (for up to 20-bit accuracy)
PREC_D_CMAKE_ON=	-DWITH_DOUBLE_PRECISION:BOOL=ON
PREC_D_CMAKE_OFF=	-DWITH_DOUBLE_PRECISION:BOOL=OFF
PREC_S_CMAKE_ON=	-DWITH_SINGLE_PRECISION:BOOL=ON
PREC_S_CMAKE_OFF=	-DWITH_SINGLE_PRECISION:BOOL=OFF

_NOUSE_DESC=	Use neither of below
AVFFT_DESC=	Use libavcodec (implies SIMD)
PFFFT_DESC=	Use PFFFT (implies SIMD)
AVFFT_IMPLIES=	SIMD
PFFFT_IMPLIES=	SIMD
AVFFT_CMAKE_ON=	-DWITH_AVFFT:BOOL=ON
AVFFT_CMAKE_OFF=	-DWITH_AVFFT:BOOL=OFF
AVFFT_LIB_DEPENDS=	libavcodec.so:${PORTSDIR}/multimedia/ffmpeg
PFFFT_CMAKE_ON=	-DWITH_PFFFT:BOOL=ON
PFFFT_CMAKE_OFF=	-DWITH_PFFFT:BOOL=OFF

.include <bsd.port.options.mk>

.if ${PORT_OPTIONS:MSHLIB}
USE_LDCONFIG=	yes
.endif

DOCSDIR=	${PREFIX}/share/doc/lib${PORTNAME}

post-patch:
	@${GREP} -El 'SOURCE_DIR}/LICENCE|AVCODEC_INCLUDE_DIRS' \
		${WRKSRC}/CMakeLists.txt | ${XARGS} ${REINPLACE_CMD} \
		-e '/$${CMAKE_CURRENT_SOURCE_DIR}\/LICENCE/d' \
		-e 's/AVCODEC_INCLUDE_DIRS/AVCODEC_INCLUDES/'

.include <bsd.port.mk>
